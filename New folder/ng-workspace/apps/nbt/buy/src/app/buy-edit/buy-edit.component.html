<div class="row" *ngIf="!loading; else loadProgress"></div>
<ng-template #loadProgress>
    <div class="row">
        <div class="col-xs-12">
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </div>
    </div>
</ng-template>

<div class="row">
    <div class="col-xs-12">
        <mat-horizontal-stepper #stepper>
            <mat-step>
                <ng-template matStepLabel>National Buy</ng-template>
                
                <div class="flex-justify-end">
                    <button mat-button color="primary" style="height:42px" (click)="setState()">Save Draft</button>
                    <button mat-button color="primary" style="height:42px" (click)="save()">Save</button>
                    <button mat-button color="warn" style="height:42px" (click)="clear()">Clear</button>            
                    <button mat-button color="warn" style="height:42px" (click)="load()">Refresh</button>            
                </div>

                <form [formGroup]="buyForm" (ngSubmit)="save()">
                    <div formGroupName="editBuy">
                        <!-- row 1 -->
                        <div class="row">
                            <div class="col-xs-4">
                                <mat-form-field>
                                    <input matInput placeholder="Name" formControlName="name" required>
                                    <mat-error><strong>required</strong></mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-xs-4">
                                <icon-list-selector [dataList]="vm.clientList" formControlName="clientName" [required]="true" 
                                    (changed)="setFormControl('clientGuid', $event)" placeholder="Client"></icon-list-selector>
                            </div>
                            <div class="col-xs-4">
                                <icon-list-selector [dataList]="vm.buyerList" formControlName="buyerName" [required]="true"
                                    (changed)="setFormControl('buyerId', $event)" placeholder="Buyer"></icon-list-selector>
                            </div>
                        </div>
                        <!-- row 2 -->
                        <div class="row">
                            <div class="col-xs-4">
                                <icon-list-selector [dataList]="vm.demoList" formControlName="demoName" [required]="true"
                                    (changed)="setFormControl('sbmsDemoId', $event)" placeholder="Demo"></icon-list-selector>
                            </div>
                            <div class="col-xs-4">
                                <icon-list-selector [dataList]="vm.agencyList" formControlName="agencyName" [required]="true"
                                    (changed)="setFormControl('agencyGuid', $event)" placeholder="ICON/Partner"></icon-list-selector>
                            </div>
                            <div class="col-xs-4">
                                <mat-form-field>
                                    <input matInput [matDatepicker]="dateRegistered" placeholder="Date Registered" formControlName="dateRegistered" required>
                                    <mat-datepicker-toggle matSuffix [for]="dateRegistered"></mat-datepicker-toggle>
                                    <mat-datepicker #dateRegistered></mat-datepicker>
                                </mat-form-field>
                            </div>
                        </div>
                        <!-- row 3 -->
                        <div class="row">
                            <div class="col-xs-4">
                                <icon-list-selector [dataList]="vm.orderBudgetList" formControlName="orderBudgetName" 
                                    (changed)="setFormControl('orderBudgetGuid', $event)" placeholder="Order Budget"></icon-list-selector>
                            </div>
                            <div class="col-xs-4">
                                <icon-list-selector [dataList]="vm.brandList" formControlName="brand"
                                    (changed)="setFormControl('sbmsBrandId', $event)" placeholder="Brand"></icon-list-selector>
                            </div>
                            <div class="col-xs-4">
                                <mat-form-field>
                                    <input matInput placeholder="Buy Type" [formControlName]="'buyType'">
                                </mat-form-field>
                            </div>
                        </div>                        
                        <!-- row 4 -->
                        <div class="row">
                            <div class="col-xs-4">
                                <div class="flex" style="justify-content: space-between;">
                                    <mat-form-field style="width:40%!important">
                                        <mat-select placeholder="Start Year" #startYear formControlName="startFlightYear" required>
                                            <mat-option *ngFor="let e of vm.yearsList" [value]="e.value">{{e.value}}</mat-option>
                                        </mat-select>
                                        <mat-error><strong>required</strong></mat-error>
                                    </mat-form-field>

                                    <mat-form-field style="width:40%!important">
                                        <mat-select placeholder="Start Quarter" #startQuarter formControlName="startFlightQuarter" required>
                                            <mat-option *ngFor="let e of appData.quarters" [value]="e.value">{{e.text}}</mat-option>
                                        </mat-select>
                                        <mat-error><strong>required</strong></mat-error>
                                    </mat-form-field>
                                </div>                                
                            </div>
                            <div class="col-xs-4">
                                <div class="flex" style="justify-content: space-between;">
                                    <mat-form-field style="width:40%!important">
                                        <mat-select placeholder="End Year" #endYear formControlName="endFlightYear" required>
                                            <mat-option *ngFor="let e of vm.yearsList | yearRange: startYear.value" [value]="e.value">                                                
                                                {{e.value}}                                                
                                            </mat-option>
                                        </mat-select>
                                        <mat-error><strong>required</strong></mat-error>
                                    </mat-form-field>

                                    <mat-form-field style="width:40%!important">
                                        <mat-select placeholder="End Quarter" formControlName="endFlightQuarter" required>
                                            <mat-option *ngFor="let e of appData.quarters | quarterRange: startYear.value: endYear.value: startQuarter.value" [value]="e.value">
                                                {{e.text}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error><strong>required</strong></mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="col-xs-4">
                                <mat-form-field>
                                    <input matInput placeholder="Comments" formControlName="comments">
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <!-- formGroupName="selectedNetworks" -->
                    <div  class="row" *ngIf="!_editBuy.id || _editBuy.id === 0">
                        <div class="col-xs-12">
                            <br>
                            <icon-multi-selector [dataList]="vm.networkList" placeholder="Networks" [selectedData]="selectedNetworks"></icon-multi-selector>
                        </div>
                    </div>
                </form>

            </mat-step>

<!-- ---------------------------------------------------------------------------- -->

            <mat-step>
                <ng-template matStepLabel>National Network</ng-template>
                <div>
                    <icon-buy-network-grid [networks]="vm.networkList" [demos]="vm.demoList" [deals]="vm.dealList"></icon-buy-network-grid>
                    {{nationalNetworkByNationalQuarterList | json}}
                </div>
            </mat-step>

<!-- ---------------------------------------------------------------------------- -->

            <mat-step>
                <ng-template matStepLabel>Version History</ng-template>
                <div>
                    3
                </div>
            </mat-step>
        </mat-horizontal-stepper>

    </div>
</div>

